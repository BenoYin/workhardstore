<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能计算器 | 知享</title>
    <!-- 外部资源CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <!-- Tailwind配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1D1D1F',
                        secondary: '#6E6E73',
                        accent: '#0071E3',
                        light: '#F5F5F7',
                        'accent-light': '#EBF5FF',
                        'premium': '#FF9500'
                    },
                    fontFamily: {
                        sans: ['-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .btn-primary {
                @apply bg-accent text-white px-5 py-2.5 rounded-md transition-all hover:bg-accent/90 active:scale-95;
            }
            .btn-secondary {
                @apply bg-light text-primary px-5 py-2.5 rounded-md transition-all hover:bg-gray-200 active:scale-95;
            }
        }
    </style>
    
    <style>
        html {
            scroll-behavior: smooth;
        }
        
        body {
            -webkit-font-smoothing: antialiased;
        }
        
        .calc-btn {
            transition: all 0.15s ease;
            user-select: none;
        }
        
        .calc-btn:active {
            transform: scale(0.95);
        }
        
        /* 历史记录动画 */
        .history-item {
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-light text-primary font-sans">
    <!-- 导航栏 -->
    <header id="navbar" class="fixed w-full top-0 z-50 bg-white/95 backdrop-blur-sm shadow-sm">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <a href="index.html" class="text-xl font-medium tracking-tight flex items-center gap-2">
                    <span class="text-accent"><i class="fa fa-lightbulb-o"></i></span>
                    <span>知享</span>
                </a>
                
                <div class="flex items-center gap-4">
                    <a href="index.html#tools" class="btn-secondary text-sm hidden sm:flex items-center gap-1">
                        <i class="fa fa-arrow-left"></i>
                        <span>返回工具列表</span>
                    </a>
                    <a href="index.html#tools" class="btn-secondary sm:hidden w-10 h-10 flex items-center justify-center">
                        <i class="fa fa-arrow-left"></i>
                    </a>
                    <a href="#" class="btn-primary text-sm hidden sm:flex items-center gap-1">
                        <i class="fa fa-user-circle-o"></i>
                        <span>登录</span>
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- 计算器主体 -->
    <main class="pt-24 pb-16 px-4 sm:px-6 lg:px-8">
        <div class="container mx-auto max-w-5xl">
            <div class="flex flex-col md:flex-row gap-8">
                <!-- 计算器主体 -->
                <div class="w-full md:w-2/3">
                    <div class="bg-white rounded-2xl shadow-sm p-6 md:p-8">
                        <div class="mb-6">
                            <h1 class="text-2xl md:text-3xl font-medium mb-2">智能计算器</h1>
                            <p class="text-secondary">支持基本运算、科学计算和单位转换</p>
                        </div>
                        
                        <!-- 计算器显示和按钮区域 -->
                        <div class="bg-light rounded-xl p-4 md:p-6">
                            <!-- 计算历史预览 -->
                            <div id="calc-history-preview" class="text-right text-secondary text-sm h-8 overflow-hidden mb-2">
                                <!-- 历史记录会在这里显示 -->
                            </div>
                            
                            <!-- 主显示区域 -->
                            <div id="calc-display" class="bg-white rounded-lg p-4 mb-6 text-right text-3xl md:text-4xl min-h-[80px] flex items-end justify-end font-light overflow-x-auto">0</div>
                            
                            <!-- 按钮区域 -->
                            <div class="grid grid-cols-4 gap-3">
                                <!-- 第一行 -->
                                <button class="calc-btn bg-gray-200 py-4 rounded-lg text-secondary hover:bg-gray-300 text-lg" data-action="clear">C</button>
                                <button class="calc-btn bg-gray-200 py-4 rounded-lg text-secondary hover:bg-gray-300 text-lg" data-action="delete">←</button>
                                <button class="calc-btn bg-gray-200 py-4 rounded-lg text-secondary hover:bg-gray-300 text-lg" data-action="operator" data-value="%">%</button>
                                <button class="calc-btn bg-accent py-4 rounded-lg text-white hover:bg-accent/90 text-lg" data-action="operator" data-value="÷">÷</button>
                                
                                <!-- 第二行 -->
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="7">7</button>
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="8">8</button>
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="9">9</button>
                                <button class="calc-btn bg-accent py-4 rounded-lg text-white hover:bg-accent/90 text-lg" data-action="operator" data-value="×">×</button>
                                
                                <!-- 第三行 -->
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="4">4</button>
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="5">5</button>
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="6">6</button>
                                <button class="calc-btn bg-accent py-4 rounded-lg text-white hover:bg-accent/90 text-lg" data-action="operator" data-value="-">-</button>
                                
                                <!-- 第四行 -->
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="1">1</button>
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="2">2</button>
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="3">3</button>
                                <button class="calc-btn bg-accent py-4 rounded-lg text-white hover:bg-accent/90 text-lg" data-action="operator" data-value="+">+</button>
                                
                                <!-- 第五行 -->
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="±">±</button>
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value="0">0</button>
                                <button class="calc-btn bg-white py-4 rounded-lg text-primary hover:bg-gray-100 text-lg" data-action="number" data-value=".">.</button>
                                <button class="calc-btn bg-accent py-4 rounded-lg text-white hover:bg-accent/90 text-lg" data-action="calculate">=</button>
                            </div>
                        </div>
                        
                        <!-- 功能标签 -->
                        <div class="mt-6 flex flex-wrap gap-2">
                            <span class="px-3 py-1 bg-accent-light text-accent text-xs rounded-full">基础计算</span>
                            <span class="px-3 py-1 bg-light text-secondary text-xs rounded-full">科学计算</span>
                            <span class="px-3 py-1 bg-light text-secondary text-xs rounded-full">单位转换</span>
                            <span class="px-3 py-1 bg-light text-secondary text-xs rounded-full">历史记录</span>
                        </div>
                    </div>
                    
                    <!-- 计算器说明 -->
                    <div class="bg-white rounded-2xl shadow-sm p-6 mt-6">
                        <h3 class="text-lg font-medium mb-4">使用说明</h3>
                        <ul class="space-y-2 text-sm text-secondary">
                            <li class="flex items-start gap-2">
                                <i class="fa fa-check-circle text-accent mt-1"></i>
                                <span>支持基本算术运算：加(+)、减(-)、乘(×)、除(÷)、取余(%)</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fa fa-check-circle text-accent mt-1"></i>
                                <span>点击"←"删除最后一位数字，点击"C"清除当前输入</span>
                            </li>
                            <li class="flex items-start gap-2">
                                <i class="fa fa-check-circle text-accent mt-1"></i>
                                <span>登录后可保存计算历史和使用高级功能</span>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- 右侧面板：历史记录和高级功能 -->
                <div class="w-full md:w-1/3">
                    <div class="bg-white rounded-2xl shadow-sm p-6 h-full">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-lg font-medium">计算历史</h3>
                            <button id="clear-history" class="text-sm text-secondary hover:text-accent">
                                清空
                            </button>
                        </div>
                        
                        <div id="history-container" class="space-y-3 max-h-[400px] overflow-y-auto pr-2">
                            <!-- 历史记录会动态添加到这里 -->
                            <div class="text-center text-secondary text-sm py-8">
                                计算历史将显示在这里
                            </div>
                        </div>
                        
                        <div class="mt-8 pt-6 border-t border-gray-100">
                            <h3 class="text-lg font-medium mb-4">高级功能</h3>
                            <div class="space-y-3">
                                <button class="w-full flex justify-between items-center p-3 border border-gray-200 rounded-lg hover:bg-light transition-colors">
                                    <span>科学计算</span>
                                    <i class="fa fa-chevron-right text-secondary"></i>
                                </button>
                                <button class="w-full flex justify-between items-center p-3 border border-gray-200 rounded-lg hover:bg-light transition-colors">
                                    <span>单位转换</span>
                                    <i class="fa fa-chevron-right text-secondary"></i>
                                </button>
                                <button class="w-full flex justify-between items-center p-3 border border-gray-200 rounded-lg hover:bg-light transition-colors">
                                    <span>房贷计算</span>
                                    <i class="fa fa-chevron-right text-secondary"></i>
                                </button>
                                <button class="w-full flex justify-between items-center p-3 border border-gray-200 rounded-lg hover:bg-light transition-colors">
                                    <span>税率计算</span>
                                    <i class="fa fa-chevron-right text-secondary"></i>
                                </button>
                            </div>
                            
                            <div class="mt-6 p-4 bg-accent-light rounded-lg">
                                <h4 class="font-medium text-accent mb-2">升级到高级版</h4>
                                <p class="text-sm text-secondary mb-3">解锁全部计算功能，无广告干扰</p>
                                <button class="w-full bg-accent text-white py-2 rounded-md text-sm hover:bg-accent/90 transition-colors">
                                    了解会员权益
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="bg-primary text-white py-12 px-4 sm:px-6 lg:px-8">
        <div class="container mx-auto max-w-6xl">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <a href="index.html" class="text-xl font-medium tracking-tight flex items-center gap-2 mb-4 md:mb-0">
                    <span class="text-accent"><i class="fa fa-lightbulb-o"></i></span>
                    <span>知享</span>
                </a>
                
                <p class="text-gray-400 text-sm">© 2023 知享. 保留所有权利.</p>
                
                <div class="flex gap-6 mt-4 md:mt-0">
                    <a href="#" class="text-gray-400 hover:text-white text-sm transition-colors">隐私政策</a>
                    <a href="#" class="text-gray-400 hover:text-white text-sm transition-colors">服务条款</a>
                    <a href="#" class="text-gray-400 hover:text-white text-sm transition-colors">联系我们</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 计算器核心变量
            const display = document.getElementById('calc-display');
            const historyPreview = document.getElementById('calc-history-preview');
            const historyContainer = document.getElementById('history-container');
            const clearHistoryBtn = document.getElementById('clear-history');
            
            let currentValue = '0';
            let previousValue = null;
            let operator = null;
            let resetOnNextInput = false;
            let calculationHistory = [];
            
            // 更新显示
            function updateDisplay() {
                // 处理大数字显示
                if (currentValue.length > 12) {
                    const num = parseFloat(currentValue);
                    if (!isNaN(num)) {
                        display.textContent = num.toExponential(6);
                        return;
                    }
                }
                display.textContent = currentValue;
            }
            
            // 添加到历史记录
            function addToHistory(expression, result) {
                const historyItem = {
                    expression: expression,
                    result: result,
                    timestamp: new Date()
                };
                
                calculationHistory.unshift(historyItem);
                // 限制历史记录数量
                if (calculationHistory.length > 20) {
                    calculationHistory.pop();
                }
                
                updateHistoryDisplay();
            }
            
            // 更新历史记录显示
            function updateHistoryDisplay() {
                // 清空容器
                if (calculationHistory.length === 0) {
                    historyContainer.innerHTML = `
                        <div class="text-center text-secondary text-sm py-8">
                            计算历史将显示在这里
                        </div>
                    `;
                    return;
                }
                
                historyContainer.innerHTML = '';
                
                // 添加历史记录项
                calculationHistory.forEach((item, index) => {
                    const historyEl = document.createElement('div');
                    historyEl.className = 'history-item p-2 border-b border-gray-100 last:border-0';
                    historyEl.innerHTML = `
                        <div class="text-sm text-secondary">${item.expression}</div>
                        <div class="font-medium">${item.result}</div>
                    `;
                    
                    // 点击历史记录项，将结果显示到计算器
                    historyEl.addEventListener('click', () => {
                        currentValue = item.result;
                        previousValue = null;
                        operator = null;
                        resetOnNextInput = false;
                        updateDisplay();
                    });
                    
                    historyContainer.appendChild(historyEl);
                });
            }
            
            // 清空历史记录
            clearHistoryBtn.addEventListener('click', () => {
                calculationHistory = [];
                historyPreview.textContent = '';
                updateHistoryDisplay();
            });
            
            // 按钮点击事件
            document.querySelectorAll('.calc-btn').forEach(button => {
                button.addEventListener('click', function() {
                    const action = this.getAttribute('data-action');
                    const value = this.getAttribute('data-value');
                    
                    if (action === 'number') {
                        // 处理正负号
                        if (value === '±') {
                            currentValue = (parseFloat(currentValue) * -1).toString();
                            updateDisplay();
                            return;
                        }
                        
                        // 处理小数点
                        if (value === '.') {
                            if (!currentValue.includes('.')) {
                                currentValue += '.';
                                updateDisplay();
                            }
                            return;
                        }
                        
                        // 处理普通数字
                        if (resetOnNextInput) {
                            currentValue = value;
                            resetOnNextInput = false;
                        } else {
                            currentValue = currentValue === '0' ? value : currentValue + value;
                        }
                        updateDisplay();
                    }
                    
                    // 运算符点击
                    else if (action === 'operator') {
                        if (previousValue === null) {
                            previousValue = currentValue;
                            historyPreview.textContent = `${currentValue} ${value}`;
                        } else if (!resetOnNextInput) {
                            // 计算当前结果
                            const result = calculateResult(true);
                            historyPreview.textContent = `${result} ${value}`;
                        } else {
                            historyPreview.textContent = `${previousValue} ${value}`;
                        }
                        operator = value;
                        resetOnNextInput = true;
                    }
                    
                    // 等于计算
                    else if (action === 'calculate' && operator && previousValue !== null) {
                        const result = calculateResult(false);
                        const expression = `${previousValue} ${operator} ${currentValue}`;
                        addToHistory(expression, result);
                        historyPreview.textContent = '';
                        operator = null;
                        previousValue = null;
                        resetOnNextInput = true;
                    }
                    
                    // 清除
                    else if (action === 'clear') {
                        currentValue = '0';
                        previousValue = null;
                        operator = null;
                        resetOnNextInput = false;
                        historyPreview.textContent = '';
                        updateDisplay();
                    }
                    
                    // 删除
                    else if (action === 'delete') {
                        if (currentValue.length > 1) {
                            currentValue = currentValue.slice(0, -1);
                        } else {
                            currentValue = '0';
                        }
                        updateDisplay();
                    }
                });
            });
            
            // 计算结果
            function calculateResult(isIntermediate) {
                const prev = parseFloat(previousValue);
                const current = parseFloat(currentValue);
                let result;
                
                switch(operator) {
                    case '+':
                        result = prev + current;
                        break;
                    case '-':
                        result = prev - current;
                        break;
                    case '×':
                        result = prev * current;
                        break;
                    case '÷':
                        if (current === 0) {
                            currentValue = '错误';
                            updateDisplay();
                            return '错误';
                        }
                        result = prev / current;
                        break;
                    case '%':
                        result = prev % current;
                        break;
                    default:
                        return currentValue;
                }
                
                // 处理整数显示（去掉多余的.0）
                const formattedResult = result % 1 === 0 ? result.toString() : result.toFixed(6).replace(/0+$/, '').replace(/\.$/, '');
                currentValue = formattedResult;
                
                if (!isIntermediate) {
                    previousValue = null;
                } else {
                    previousValue = formattedResult;
                }
                
                updateDisplay();
                return formattedResult;
            }
            
            // 键盘支持
            document.addEventListener('keydown', function(e) {
                // 数字键
                if (/[0-9]/.test(e.key)) {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="number"][data-value="${e.key}"]`).click();
                }
                // 运算符
                else if (e.key === '+') {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="operator"][data-value="+"]`).click();
                } else if (e.key === '-') {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="operator"][data-value="-"]`).click();
                } else if (e.key === '*') {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="operator"][data-value="×"]`).click();
                } else if (e.key === '/') {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="operator"][data-value="÷"]`).click();
                }
                // 其他功能键
                else if (e.key === 'Enter') {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="calculate"]`).click();
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="clear"]`).click();
                } else if (e.key === 'Backspace') {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="delete"]`).click();
                } else if (e.key === '.') {
                    e.preventDefault();
                    document.querySelector(`.calc-btn[data-action="number"][data-value="."]`).click();
                }
            });
        });
    </script>
</body>
</html>
    